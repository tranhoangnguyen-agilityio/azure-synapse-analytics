{
    "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
    "handler": "Microsoft.Azure.CreateUIDef",
    "version": "0.1.2-preview",
    "parameters": {
        "basics": [
            {}
        ],
        "steps": [
            {
                "name": "dataSourceSetting",
                "label": "SQL Server Data source setting",
                "elements": [
                    {
                        "name": "serverName",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Server name",
                        "placeholder": "Server name",
                        "defaultValue": "sqlservercentralpublic.database.windows.net",
                        "constraints": {
                            "required": true
                        },
                        "visible": true
                    },
                    {
                        "name": "databaseName",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Database name",
                        "placeholder": "Database name",
                        "defaultValue": "AdventureWorks",
                        "constraints": {
                            "required": true
                        },
                        "visible": true
                    },
                    {
                        "name": "userName",
                        "type": "Microsoft.Common.TextBox",
                        "label": "User name",
                        "placeholder": "User name",
                        "defaultValue": "sqlfamily",
                        "constraints": {
                            "required": true
                        },
                        "visible": true
                    },
                    {
                        "name": "password",
                        "type": "Microsoft.Common.PasswordBox",
                        "options": {
                            "hideConfirmation": true
                        },
                        "constraints": {
                            "required": true
                        },
                        "visible": true
                    }

                ]
            },
            {
                "name": "synapseSetting",
                "label": "Synapse Workspace",
                "bladeTitle": "Synapse credentials",
                "subLabel": {
                    "preValidation": "Provide Synapase's setting",
                    "postValidation": "Great - let's move on!"
                },
                "elements": [
                    {
                        "name": "workspaceName",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Synapse workspace name",
                        "placeholder": "Workspace name",
                        "defaultValue": "",
                        "toolTip": "Use only allowed characters",
                        "constraints": {
                            "required": true,
                            "regex": "^[a-z0-9A-Z]{1,30}$",
                            "validationMessage": "Only alphanumeric characters are allowed, and the value must be 1-30 characters long."
                        },
                        "visible": true
                    },
                    {
                        "name": "storageAccounts",
                        "type": "Microsoft.Storage.MultiStorageAccountCombo",
                        "label": {
                            "prefix": "Storage account name prefix",
                            "type": "Storage account type"
                        },
                        "defaultValue": {
                            "prefix": "stracct",
                            "type": "Standard_LRS"
                        },
                        "constraints": {
                            "allowedTypes": [
                                "Premium_LRS",
                                "Standard_LRS",
                                "Standard_GRS"
                            ]
                        },
                        "count": 1
                    }
                ]
            }
        ],
        "outputs": {
            "location": "[location()]",
            "workspaceName": "[steps('synapseSetting').workspaceName]",
            "collectiv-WorkspaceDefaultSqlServer_connectionString": "[concat('Integrated Security=False;Encrypt=True;Connection Timeout=30;Data Source=tcp:', steps('synapseSetting').workspaceName, '.sql.azuresynapse.net,1433;Initial Catalog=@{linkedService().DBName}')]",
            "serverlessSQLdb_connectionString": "[concat('Integrated Security=False;Encrypt=True;Connection Timeout=30;Data Source=', steps('synapseSetting').workspaceName, '-ondemand.sql.azuresynapse.net;Initial Catalog=', steps('synapseSetting').workspaceName, '-gold-db')]",
            "dataSource_serverName": "[steps('dataSourceSetting').serverName]",
            "dataSource_userName": "[steps('dataSourceSetting').userName]",
            "dataSource_password": "[steps('dataSourceSetting').password]",
            "dataSource_databaseName": "[steps('dataSourceSetting').databaseName]",
            "storageAccountName": "[concat('https://', steps('synapseSetting').storageAccounts.prefix, '1' ,'.dfs.core.windows.net')]"
        }
    }
}
